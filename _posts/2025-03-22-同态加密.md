---
layout: post
title: "同态加密_学习笔记"
date: 2025-03-22
categories: [ctf, Crypto]
tags: [ctf,Crypto]
author: l0fxxs
math: true
---

### 半同态加密

#### Paillier加密系统

1.密钥生成
Paillier加密系统的密钥生成过程需要选择两个大素数，并使用它们来生成公钥和私钥。

- **选择两个大素数** $ p $ 和 $ q $。

- **计算模数** $ n = p \times q $，其中 $ n $ 是模数，公钥中的一个部分。

- **计算加密系统的秘密参数** $ \lambda(n) = \text{lcm}(p-1, q-1) $，其中 $ \text{lcm} $ 是最小公倍数，$ \lambda(n) $ 是加密系统的秘密参数。

- **选择一个随机整数** $ g $，要求 $ g $ 的阶为 $ n $ 的整数倍，$g^\lambda=1+an\ mod\ n^2$,$gcd(L(g^\lambda\ mod\ n^2),n)=1$,一般而言$g=n+1$是一个比较选择
- **计算** $ \mu = \left( L(g^{\lambda(n)} \mod n^2) \right)^{-1} \mod n $，其中 $ L(x) = \frac{x - 1}{n} $ 是一个辅助函数。

最终，Paillier的公钥是$(n,g)$,私钥是$(\lambda,\mu)$

2.加密
要求密文$m < n$

- **选择一个随机整数** $ r $,要求$ r < n $

-  **加密** $ c=g^m*r^n mod\ n^2 $

3.解密

- **解密** $m=L(c^\lambda \ mod\ n^2)*\mu \ mod\ n $

4.同态性
这个系统仅有加法同态性
对密文$m1\ m2$

- $c_1=g^{m_1}*r_1^{n}\ mod\ n^2$
- $c_2=g^{m_2}*r_2^{n}\ mod\ n^2$

同态加法
- $c_3=c_1 *c_2\ mod\ n^2 $

证明:
- $c_3=g^{m_1+m_2}*(r_1*r_2)^{n}\ mod\ n^2$

设$r_3=r_1*r_2$
  
- 则$c_3=g^{m_1+m_2}*(r_3)^{n}\ mod\ n^2$

对$c_3$解密:
- $m_3=L(c_3^\lambda \ mod\ n^2)*\mu \ mod\ n $
- $m_3=L((g^{m_1+m_2}*(r_3)^{n}\ mod\ n^2)^\lambda \ mod\ n^2)*\mu \ mod\ n$
- $m_3=L((g^{(m_1+m_2)*\lambda}*(r_3)^{n*\lambda}) \ mod\ n^2)*\mu \ mod\ n$

利用$r^{n*\lambda}=1\ mod\ n^2$
- $m_3=L((g^{(m_1+m_2)*\lambda}) \ mod\ n^2)*\mu \ mod\ n$

代入解密函数$L(x)=(x-1)/n$，注意以下就$g=n+1$进行讨论
分析$g^{m*\lambda}\ mod\ n^2$
- $g^{m*\lambda}\ mod\ n^2=(n+1)^{m*\lambda}\ mod\ n^2$

二项式定理
- $(n+1)^{m*\lambda}\ mod\ n^2=1+(m*\lambda)*n \ mod\ n^2$    #高阶项被约掉了

代入$L(x)=(x-1)/n$
- $L((g^{(m_1+m_2)*\lambda}) \ mod\ n^2)=L(1+(m*\lambda)*n \ mod\ n^2)=m*\lambda\ mod\ n$

所以
- $L((g^{(m_1+m_2)*\lambda}) \ mod\ n^2)=m*\lambda\ mod\ n$
- $m_3=L((g^{(m_1+m_2)*\lambda}) \ mod\ n^2)*\mu \ mod\ n=(m_1+m_2)*\lambda*\mu\ mod\ n$

利用$\mu$的定义$ \mu = \left( L(g^{\lambda(n)} \mod n^2) \right)^{-1} \mod n $
- $m_3=m_1+m_2\ mod\ n$

得证
其实上面的证明就是对解密的证明，如果解密已被证明,在令$m_3=L((g^{(m_1+m_2)*\lambda}*(r_3)^{n*\lambda}) \ mod\ n^2)*\mu \ mod\ n$已经可以有$m_3=m_1+m_2$







